<!-- Camera and Zone List -->
<div class="d-flex flex-row gap-4 mb-4" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
  <!-- Camera List -->
  <div class="bg-white p-3 rounded shadow-sm" style="width: 100%;">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Cameras</h5>
      <button class="btn btn-primary btn-sm" (click)="openCameraDialog()">
        <i class="fas fa-plus"></i> Add Camera
      </button>
    </div>
    <div class="cameras-items"
      style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.75rem;">
      <div *ngFor="let camera of availableCameras"
        class="camera-item d-flex align-items-center p-1 bg-light rounded shadow-sm" [draggable]="true"
        (dragstart)="onDragStart($event, camera)" (dragend)="onDragEnd($event)" style="min-width: 0;">
        <i class="bi bi-camera-fill me-2 text-primary"></i>
        <span class="camera-name flex-fill">{{ camera.cameraName }}</span>
        <span class="camera-dot ms-2" [ngClass]="{
          'dot-green': camera.status === 'ACTIVE',
          'dot-yellow': camera.status === 'MAINTENANCE',
          'dot-red': camera.status === 'INACTIVE'
        }">●</span>
      </div>
    </div>
  </div>

  <!-- Zone List -->
  <div class="bg-white p-3 rounded shadow-sm" style="width: 100%;">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Zones</h5>
      <button class="btn btn-primary btn-sm" (click)="openZoneDialog()">
        <i class="fas fa-plus"></i> Add Zone
      </button>
    </div>
    <div class="zone-items"
      style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.75rem;">
      <ng-container *ngFor="let zone of zones">
        <div *ngIf="!zone.isActive"
          class="zone-item d-flex align-items-center p-1 bg-light rounded shadow-sm zone-inactive" [draggable]="true"
          (dragstart)="onZoneDragStart($event, zone)" (dragend)="onZoneDragEnd($event, zone)"
          [attr.title]="'Drag to map'" style="min-width: 0; opacity: 1; cursor: grab;">
          <span class="zone-dot me-2 dot-red">●</span>
          <span class="zone-name flex-fill">{{ zone.zoneName }}</span>
          <button class="btn btn-outline-danger btn-sm ms-2 py-0 px-1" style="font-size: 0.9em; line-height: 1;"
            (click)="removeZoneFromMap(zone.id)" [disabled]="true" [attr.title]="'Zone not on map'">&times;</button>
        </div>
        <div *ngIf="zone.isActive"
          class="zone-item d-flex align-items-center p-2 bg-light rounded shadow-sm zone-active" [draggable]="false"
          [attr.title]="'Zone is already on the map'" style="min-width: 0; opacity: 0.5; cursor: not-allowed;">
          <span class="zone-dot me-2 dot-green">●</span>
          <span class="zone-name flex-fill">{{ zone.zoneName }}</span>
          <button class="btn btn-outline-danger btn-sm ms-2 py-0 px-1" style="font-size: 0.9em; line-height: 1;"
            (click)="removeZoneFromMap(zone.id)" [disabled]="false" [attr.title]="'Remove from map'">&times;</button>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<!-- Store Map Area -->
<div class="store-map-container bg-white p-4 rounded shadow-sm">
  <div class="store-map">
    <div class="map-container" (dragover)="onMapDragOver($event)" (drop)="onMapDrop($event)">
      <!-- Zones on the map -->
      <ng-container *ngFor="let zone of zones">
        <div class="zone" [style.left.px]="zone.position.x" [style.top.px]="zone.position.y"
          [style.width.px]="zone.position.width" [style.height.px]="zone.position.height"
          [style.background-color]="zone.color" [class.resizing]="isZoneResizing(zone)"
          (mousedown)="onZoneMouseDown($event, zone)" *ngIf="zone.isActive">
          <div class="zone-header d-flex align-items-center justify-content-between">
            <span class="zone-dot me-2" [ngClass]="{'dot-green': zone.isActive, 'dot-red': !zone.isActive}">●</span>
            <span class="zone-name flex-fill">{{ zone.zoneName }}</span>
            <button class="btn btn-outline-danger btn-sm ms-2 py-0 px-1" style="font-size: 0.9em; line-height: 1;"
              (click)="removeZoneFromMap(zone.id)">&times;</button>
          </div>
          <div class="zone-content">
            <div class="drop-zone-indicator" *ngIf="zone.cameras.length === 0">
              <i class="fas fa-camera"></i>
              <span>Drop camera here</span>
            </div>
            <div class="camera-list">
              <div class="camera-item d-flex align-items-center" *ngFor="let camera of zone.cameras">
                <i class="bi bi-camera-fill me-2 text-primary"></i>
                <span class="camera-name flex-fill">{{ camera.cameraName }}</span>
                <span class="camera-dot ms-2" [ngClass]="{
                  'dot-green': camera.status === 'ACTIVE',
                  'dot-yellow': camera.status === 'MAINTENANCE',
                  'dot-red': camera.status === 'INACTIVE'
                }">●</span>
                <button class="btn btn-outline-danger btn-sm ms-2 py-0 px-1" style="font-size: 0.9em; line-height: 1;"
                  (click)="removeCameraFromZone(camera.id, zone.id)">&times;</button>
              </div>
            </div>
          </div>
          <!-- Resize handles -->
          <div class="resize-handle resize-handle-e" (mousedown)="onZoneResizeStart($event, zone, 'e')"></div>
          <div class="resize-handle resize-handle-s" (mousedown)="onZoneResizeStart($event, zone, 's')"></div>
          <div class="resize-handle resize-handle-se" (mousedown)="onZoneResizeStart($event, zone, 'se')"></div>
        </div>
      </ng-container>

      <!-- Empty state message -->
      <div class="initial-message text-center" *ngIf="zones.length === 0">
        <i class="fas fa-map-marked-alt"></i>
        <h3>Start Building Your Map</h3>
        <p>Add zones to organize your cameras</p>
      </div>
    </div>
  </div>
</div>

<!-- Camera Dialog -->
<div class="modal fade show" tabindex="-1"
  [ngStyle]="{display: showCameraDialog ? 'block' : 'none', background: 'rgba(0,0,0,0.3)'}" *ngIf="showCameraDialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Camera</h5>
        <button type="button" class="btn-close" (click)="closeCameraDialog()"></button>
      </div>
      <div class="modal-body">
        <form #cameraForm="ngForm" (ngSubmit)="addCamera()">
          <div class="form-group mb-2">
            <label>ID</label>
            <input type="text" class="form-control" [(ngModel)]="newCamera.id" name="id" required>
          </div>
          <div class="form-group mb-2">
            <label>Camera Name</label>
            <input type="text" class="form-control" [(ngModel)]="newCamera.cameraName" name="cameraName" required>
          </div>
          <div class="form-group mb-2">
            <label>Resolution Width</label>
            <input type="number" class="form-control" [(ngModel)]="newCamera.resolutionWidth" name="resolutionWidth"
              required>
          </div>
          <div class="form-group mb-2">
            <label>Resolution Height</label>
            <input type="number" class="form-control" [(ngModel)]="newCamera.resolutionHeight" name="resolutionHeight"
              required>
          </div>
          <div class="form-group mb-2">
            <label>Stream URL</label>
            <input type="text" class="form-control" [(ngModel)]="newCamera.streamUrl" name="streamUrl">
          </div>
          <div class="form-group mb-2">
            <label>Status</label>
            <select class="form-select" [(ngModel)]="newCamera.status" name="status">
              <option value="ACTIVE">Active</option>
              <option value="INACTIVE">Inactive</option>
              <option value="MAINTENANCE">Maintenance</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeCameraDialog()">Cancel</button>
            <button type="submit" class="btn btn-primary">Add Camera</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Zone Dialog -->
<div class="modal fade show" tabindex="-1"
  [ngStyle]="{display: showZoneDialog ? 'block' : 'none', background: 'rgba(0,0,0,0.3)'}" *ngIf="showZoneDialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Zone</h5>
        <button type="button" class="btn-close" (click)="closeZoneDialog()"></button>
      </div>
      <div class="modal-body">
        <form #zoneForm="ngForm" (ngSubmit)="addZone()">
          <div class="form-group mb-2">
            <label>ID</label>
            <input type="text" class="form-control" [(ngModel)]="newZone.id" name="id" required>
          </div>
          <div class="form-group mb-2">
            <label>Zone Name</label>
            <input type="text" class="form-control" [(ngModel)]="newZone.zoneName" name="zoneName" required>
          </div>
          <div class="form-group mb-2">
            <label>Zone Type</label>
            <select class="form-select" [(ngModel)]="newZone.zoneType" name="zoneType">
              <option value="PRODUCT">Product</option>
              <option value="CHECKOUT">Checkout</option>
              <option value="ENTRANCE">Entrance</option>
              <option value="CORRIDOR">Corridor</option>
            </select>
          </div>
          <div class="form-group mb-2">
            <label>Min Dwell Time</label>
            <input type="number" class="form-control" [(ngModel)]="newZone.minDwellTime" name="minDwellTime" required>
          </div>
          <div class="form-group mb-2">
            <label>Active</label>
            <input type="checkbox" class="form-check-input" [(ngModel)]="newZone.isActive" name="isActive">
          </div>
          <div class="form-group mb-2">
            <label>Color</label>
            <input type="color" class="form-control form-control-color" [(ngModel)]="newZone.color" name="color">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeZoneDialog()">Cancel</button>
            <button type="submit" class="btn btn-primary">Add Zone</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>